---
import { getRelativeLocaleUrl } from 'astro:i18n';
import { getCurrentLocale } from '@scripts/localeFinder.ts';

const { locale, restOfPath } = getCurrentLocale({url: Astro.url, returnRestOfPath:true});
const thisPageEn = getRelativeLocaleUrl("en", restOfPath);
const thisPageIt = getRelativeLocaleUrl("it", restOfPath);

const english = locale === "en";
const rootLink = getRelativeLocaleUrl(locale, "/");
const about = english ? "About" : "Info";
const aboutLink = getRelativeLocaleUrl(english ? "en" : "it", "aboutme");
//const contact = english ? "Contacts" : "Contatti";
//const contactLink = english ? "/contacts" : `/contacts/${lang}`;

const lightTip = english ? "Turn on the lights" : "Accendi la luce";
const darkTip = english ? "Turn off the lights" : "Spegni la luce";

const englishClass = english ? "hidden tooltip" : "tooltip";
const italianClass = english ? "tooltip" : "hidden tooltip";


import Logo from "@components/body/Logo.astro";

import "@styles/navbar.css"
import "@styles/tooltip.css";
---

<nav class="navbar row">
    <Logo isNavStr='true' {rootLink} {locale} />

  <div class="row">
    <div id="theme-selection">
      <!-- light theme -->
      <div class="hidden tooltip" id="light-theme">
        <i class="fa-solid fa-sun fa-2xl"></i>
        <span class="tooltiptext-bottom">{lightTip}</span>
      </div>
      <!-- dark theme -->
      <div class="hidden tooltip" id="dark-theme"> 
        <i class="fa-solid fa-moon fa-2xl"></i>
        <span class="tooltiptext-bottom">{darkTip}</span>
      </div>
    </div>

    <!-- useful links -->
    <ul class="row" id="header-links">
      <li>
        <a href={rootLink}>Home</a>
      </li>
      <li>
        <a href={aboutLink}>{about}</a>
      </li>
      <!--
      <li>
        <a href={contactLink}>{contact}</a>
      </li>
      -->
    </ul>

    <!-- language selection -->
    <div id="language-selection">
      <!-- english -->
      <a href={thisPageEn} class={englishClass} data-language-to="en">
        <i class="fa-solid fa-chess-queen fa-2xl"></i>
        <span class="tooltiptext-bottom">Read in english</span>
      </a>
      <!-- italian -->
      <a href={thisPageIt} class={italianClass} data-language-to="it">
        <i class="fa-solid fa-pizza-slice fa-2xl"></i>
        <span class="tooltiptext-bottom">Leggi in italiano</span>
      </a>

    </div>
    <!--<button id="collapseButton" type="button" />-->
  </div>
</nav>

<script src="@scripts/themeSwitch.ts"></script>
<script>
    const searchParams = new URLSearchParams(location.search);
    if (searchParams.size > 0) {
        document.querySelectorAll('#language-selection > a')
            .forEach(el => {
                const url = new URL(el.href);
                // Add current page's search params to the link's existing params
                searchParams.forEach((value, key) => {
                    url.searchParams.set(key, value);
                });
                el.href = url.toString();
            });
    }
</script>
